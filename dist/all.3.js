function Animacao(i){"use strict";this.context=i,this.sprites=[],this.ligado=!1,this.processamentos=[],this.spritesExcluir=[],this.processamentosExcluir=[],this.ultimoCiclo=0,this.decorrido=0}function Colisor(){this.sprites=[],this.spritesExcluir=[],this.aoColidir=null}function Spritesheet(i,t,a,o){"use strict";this.context=i,this.imagem=t,this.numLinhas=a,this.numColunas=o,this.intervalo=0,this.linha=0,this.coluna=0,this.fimDoCiclo=null}function Touch(i,t,a,o){this.x=canvas.width/2,this.y=canvas.height/2,this.canvas=t.canvas,this.arrastando=!1,this.raio=90;var s=this;this.touchCount=0;var e=function(i){var t=c(i.changedTouches[0].pageX-s.canvas.offsetLeft,i.changedTouches[0].pageY-s.canvas.offsetTop),o=t.x,e=t.y,n=Math.abs(s.x-o),r=Math.abs(s.y-e);n^2+r^2<=s.raio^2&&(a&&a(),s.arrastando=!0,s.touchCount++,s.x=o,s.y=e,xAnterior=s.x,yAnterior=s.y),navigator.userAgent.match(/Android/i)&&i.preventDefault()},n=function(i){if(s.arrastando){xAnterior=s.x,yAnterior=s.y;var t=c(i.changedTouches[0].pageX-s.canvas.offsetLeft,i.changedTouches[0].pageY-s.canvas.offsetTop);s.x=t.x,s.y=t.y}},r=function(i){o&&s.touchCount>1&&o(),s.arrastando=!1},c=function(i,t){return{x:canvas.width*i/s.canvas.offsetWidth,y:canvas.height*t/s.canvas.offsetHeight}};i.addEventListener("touchstart",e),i.addEventListener("touchmove",n),i.addEventListener("touchend",r)}function Teclado(i){"use strict";this.elemento=i,this.pressionadas=[],this.disparadas=[],this.wasPressed=!1,this.funcoesDisparo=[];var t=this;i.addEventListener("keydown",function(i){var a=i.keyCode;t.pressionadas[a]=!0,t.funcoesDisparo[a]&&!t.disparadas[a]&&(t.disparadas[a]=!0,t.funcoesDisparo[a]())}),i.addEventListener("keyup",function(i){t.wasPressed=!0,setTimeout(function(){t.pressionadas[i.keyCode]=!1,t.disparadas[i.keyCode]=!1},120)})}function Button(i,t,a,o,s){function e(i,t,a){var o=i.x,s=i.x+i.width,e=i.y,n=i.y+i.height;return s>=t&&o<=t&&n>=a&&e<=a}this.imgButton=t,this.x=a,this.y=o,this.context=i.getContext("2d");var n=this,r=function(t){var a,o;t.changedTouches?(a=t.changedTouches[0].pageX,o=t.changedTouches[0].pageY):(a=t.clientX,o=t.clientY);var c={x:n.x,y:n.y,width:n.imgButton.width,height:n.imgButton.height};e(c,a,o)&&(i.removeEventListener("touchstart",r),i.removeEventListener("click",r),s())};i.addEventListener("touchstart",r),i.addEventListener("click",r)}function Fundo(i,t){this.context=i,this.imagem=t,this.velocidade=0,this.posicaoEmenda=0,this.screenWidth=this.context.canvas.width,this.newImgHeight=this.screenWidth*this.imagem.height/this.imagem.width}function MilleniumFalcon(i,t,a,o,s){"use strict";this.context=i,this.teclado=t,this.touch=s,this.imagem=a,this.x=0,this.y=0,this.velocidade=0,this.imagemExplosao=o,this.acabaramVidas=null,this.vidasExtras=3,this.stringUnica="falcon",this.ultimoTiro=(new Date).getTime()}function TieFighter(i,t,a){"use strict";this.context=i,this.imagem=t,this.x=0,this.y=0,this.direction=Math.floor(-2+6*Math.random()),this.velocidade=0,this.imgExplosao=a,this.stringUnica="tie"+this.x+this.y,this.canvasWidth=i.canvas.width,this.canvasHeight=i.canvas.height}function Asteroid(i,t,a){"use strict";this.context=i,this.imagem=t,this.x=0,this.y=0,this.velocidade=0,this.imgExplosao=a,this.stringUnica="asteroid"+this.x+this.y,this.canvasWidth=i.canvas.width,this.canvasHeight=i.canvas.height}function Tiro(i,t){"use strict";this.context=i,this.nave=t,this.largura=3,this.altura=12,this.x=t.x+32,this.y=t.y-20,this.velocidade=250,this.cor="red",SOM_TIRO.currentTime=0,SOM_TIRO.play(),this.stringUnica="tiro"+this.x+this.y}function Explosao(i,t,a,o){this.context=i,this.imagem=t,this.spritesheet=new Spritesheet(i,t,1,5),this.spritesheet.intervalo=110;var s=this;this.fimDaExplosao=null,this.x=a,this.y=o,this.spritesheet.fimDoCiclo=function(){s.animacao.excluirSprite(s),s.fimDaExplosao&&s.fimDaExplosao()},SOM_EXPLOSAO.currentTime=0,SOM_EXPLOSAO.play()}function Painel(i,t,a){"use strict";this.context=i,this.nave=t,this.imagemVida=a,this.pontuacao=0,this.pontuacaoMaxima=0}function carregarMusicas(){"use strict";musicaAcao=new Audio,musicaAcao.load(),musicaAcao.volume=.8,musicaAcao.loop=!0}function carregarImagens(){imagens={espaco:"space.png",milleniumFalcon:"sprite-nave.png",tieFighter:"tie.png",imgAsteroid:"asteroid.png",imgExplosao:"explosao.png",imgVida:"nave-vida.png",imgButtonStart:"start.svg",imgButtonCredits:"credits.svg",logo:"logo.svg",I:"I.jpg"};for(var i in imagens){var t=new Image;t.src="img/"+imagens[i],t.onload=carregando,totalImagens++,imagens[i]=t}}function carregando(){if(context.save(),context.fillStyle="#000",context.fillRect(0,0,canvas.width,canvas.height),carregadas++,carregadas==totalImagens){var i=canvas.width/2-65,t=canvas.height/2-100;new Button(canvas,imagens.imgButtonStart,i,t,configureAndStartGame).draw(),t+=140,new Button(canvas,imagens.imgButtonCredits,i,t,showCredits).draw(),i=canvas.width/2-80,t=50,context.drawImage(imagens.logo,i,t,imagens.logo.width,imagens.logo.height)}context.restore()}function showCredits(){window.location.href="credits.html"}function configureAndStartGame(){iniciarObjetos(),iniciarJogo()}function iniciarObjetos(){animacao=new Animacao(context),teclado=new Teclado(document),touch=new Touch(document,context,unPause,pause),colisor=new Colisor,espaco=new Fundo(context,imagens.espaco),milleniumFalcon=new MilleniumFalcon(context,teclado,imagens.milleniumFalcon,imagens.imgExplosao,touch),painel=new Painel(context,milleniumFalcon,imagens.imgVida),painel.pontuacaoMaxima=obterPontucaoMaxima(),animacao.novoSprite(espaco),animacao.novoSprite(milleniumFalcon),colisor.novoSprite(milleniumFalcon),animacao.novoProcessamento(colisor),animacao.novoSprite(painel),configuracoesIniciais()}function iniciarJogo(){isGameOver=!1,criacaoInimigos.ultimoCriado=(new Date).getTime(),painel.pontuacao=0,animacao.ligar(),ativarTiro(!0),teclado.disparou(ENTER,doPauseOrUnPause)}function obterPontucaoMaxima(){return localStorage.getItem("pontucaoMaxima")?localStorage.getItem("pontucaoMaxima"):0}function setarPontuacaoMaxima(i){localStorage.setItem("pontucaoMaxima",i)}function verificarSePontucaoMaxima(i){return!localStorage.getItem("pontucaoMaxima")||Number(localStorage.getItem("pontucaoMaxima"))<i}function configuracoesIniciais(){colisor.aoColidir=function(i,t){(i instanceof Tiro&&t instanceof TieFighter||i instanceof TieFighter&&t instanceof Tiro)&&(painel.pontuacao+=20,verificarSePontucaoMaxima(painel.pontuacao)&&setarPontuacaoMaxima(painel.pontuacao),painel.pontuacaoMaxima=obterPontucaoMaxima())},espaco.velocidade=30,milleniumFalcon.posicionar(),milleniumFalcon.velocidade=315,milleniumFalcon.velocidade=305,criacaoInimigos(),milleniumFalcon.acabaramVidas=function(){animacao.desligar(),gameOver()}}function gameOver(){isGameOver=!0,ativarTiro(!1),teclado.disparou(ENTER,null),musicaAcao.pause(),musicaAcao.curretTime=0,context.save(),context.fillStyle="red",context.font="30px Lcd-Solid",context.fillText("GAME OVER",canvas.width/2-80,canvas.height/2-30),context.fillStyle="white",context.font="17px Lcd-Solid",context.fillText("Tap to restart",canvas.width/2-70,canvas.height/2-10),context.restore(),milleniumFalcon.vidasExtras=3,milleniumFalcon.posicionar(),animacao.novoSprite(milleniumFalcon),colisor.novoSprite(milleniumFalcon),removerInimigos()}function removerInimigos(){for(var i=0,t=this.sprites.length;i<t;i++)animacao.sprites[i]instanceof TieFighter&&animacao.excluirSprite(animacao.sprites[i])}function doPauseOrUnPause(){return animacao.ligado?void pause():void unPause()}function unPause(){return isGameOver?void iniciarJogo():(criacaoInimigos.ultimoCriado=(new Date).getTime(),animacao.ligar(),void ativarTiro(!0))}function pause(){isGameOver||(animacao.desligar(),ativarTiro(!1),context.save(),context.fillStyle="yellow",context.font="30px Lcd-Solid",context.fillText("PAUSE",canvas.width/2-45,canvas.height/2-30),context.restore())}function ativarTiro(i){i?teclado.disparou(ESPACO,function(){milleniumFalcon.atirar()}):teclado.disparou(ESPACO,null)}function criacaoInimigos(){var i={ultimoCriado:(new Date).getTime(),processar:function(){var i=(new Date).getTime(),t=i-this.ultimoCriado;t>900&&(newEnemy(),this.ultimoCriado=i)}};animacao.novoProcessamento(i)}function newEnemy(){var i=instanceEnemy();i.velocidade=Math.floor(90+251*Math.random()),i.x=Math.floor(Math.random()*(canvas.width-i.imagem.width+1)),i.y=-i.imagem.height,animacao.novoSprite(i),colisor.novoSprite(i),animacao.novoProcessamento(colisor)}function instanceEnemy(){var i=Math.floor(2*Math.random())+1;return 1==i?new TieFighter(context,imagens.tieFighter,imagens.imgExplosao):new Asteroid(context,imagens.imgAsteroid,imagens.imgExplosao)}Animacao.prototype={novoProcessamento:function(i){this.processamentos.push(i),i.animacao=this},novoSprite:function(i){this.sprites.push(i),i.animacao=this},ligar:function(){this.ultimoCiclo=0,this.ligado=!0,this.proximoFrame()},desligar:function(){this.ligado=!1},proximoFrame:function(){if(this.ligado){this.processarExclusoes();var i=(new Date).getTime();0==this.ultimoCiclo&&(this.ultimoCiclo=i),this.decorrido=i-this.ultimoCiclo;for(var t=0,a=this.sprites.length;t<a;t++)this.sprites[t].atualizar(),this.sprites[t].desenhar();for(var t=0,a=this.processamentos.length;t<a;t++)this.processamentos[t].processar();this.ultimoCiclo=i;var o=this;requestAnimationFrame(function(){o.proximoFrame()})}},limparTela:function(){var i=this.context;i.clearRect(0,0,i.canvas.width,i.canvas.height)},excluirSprite:function(i){this.spritesExcluir.push(i)},excluirProcessamento:function(i){this.processamentosExcluir.push(i)},processarExclusoes:function(){for(var i=[],t=[],a=0,o=this.sprites.length;a<o;a++)this.spritesExcluir.indexOf(this.sprites[a])==-1&&i.push(this.sprites[a]);for(var a=0,s=this.processamentos.length;a<s;a++)this.processamentosExcluir.indexOf(this.processamentos[a])==-1&&t.push(this.processamentos[a]);this.spritesExcluir=[],this.processamentosExcluir=[],this.sprites=i,this.processamentos=t}},Colisor.prototype={novoSprite:function(i){this.sprites.push(i),i.colisor=this},processar:function(){for(var i=new Object,t=0,a=this.sprites.length;t<a;t++)for(var o=0,s=this.sprites.length;o<s;o++)if(t!=o){var e=this.stringUnica(this.sprites[t]),n=this.stringUnica(this.sprites[o]);i[e]||(i[e]=[]),i[n]||(i[n]=[]),i[e].indexOf(n)>=0||i[n].indexOf(e)>=0||(this.testarColisao(this.sprites[t],this.sprites[o]),i[e].push(n),i[n].push(e))}this.processarExclusoes()},testarColisao:function(i,t){var a=i.retangulosColisao(),o=t.retangulosColisao();i:for(var s=0,e=a.length;s<e;s++)for(var n=0,r=o.length;n<r;n++)if(this.retangulosColidem(a[s],o[n])){i.colidiuCom(t),t.colidiuCom(i),this.aoColidir&&this.aoColidir(i,t);break i}},retangulosColidem:function(i,t){return i.x+i.largura>t.x&&i.x<t.x+t.largura&&i.y+i.altura>t.y&&i.y<t.y+t.altura},stringUnica:function(i){var t=i.retangulosColisao();return"x:"+t[0].x+",y:"+t[0].y+",l:"+t[0].largura+",a:"+t[0].altura+"\n"},excluirSprite:function(i){this.spritesExcluir.push(i)},processarExclusoes:function(){for(var i=[],t=0,a=this.sprites.length;t<a;t++)this.spritesExcluir.indexOf(this.sprites[t])==-1&&i.push(this.sprites[t]);this.spritesExcluir=[],this.sprites=i}},Spritesheet.prototype={proximoQuadro:function(){var i=(new Date).getTime();this.ultimoTempo||(this.ultimoTempo=i),i-this.ultimoTempo<this.intervalo||(this.coluna<this.numColunas-1?this.coluna++:(this.coluna=0,this.fimDoCiclo&&this.fimDoCiclo()),this.ultimoTempo=i)},desenhar:function(i,t){var a=this.imagem.width/this.numColunas,o=this.imagem.height/this.numLinhas;this.context.drawImage(this.imagem,a*this.coluna,o*this.linha,a,o,i,t,a,o)}},Touch.prototype={posicaoX:function(){return this.x},posicaoY:function(){return this.y}};var SETA_ESQUERDA=37,SETA_DIREITA=39,SETA_ACIMA=38,SETA_ABAIXO=40,ESPACO=32,ENTER=13;Teclado.prototype={pressionada:function(i){return this.pressionadas[i]},hasPressed:function(){return this.wasPressed},disparou:function(i,t){this.funcoesDisparo[i]=t}},Button.prototype={draw:function(){this.context.drawImage(this.imgButton,this.x,this.y,this.imgButton.width,this.imgButton.height)}},Fundo.prototype={atualizar:function(){this.posicaoEmenda+=this.velocidade*this.animacao.decorrido/520,this.posicaoEmenda>this.newImgHeight&&(this.posicaoEmenda=0)},desenhar:function(){var i=this.imagem,t=this.posicaoEmenda-this.newImgHeight;this.context.drawImage(i,0,t,this.screenWidth,this.newImgHeight);var t=this.posicaoEmenda;this.context.drawImage(i,0,t,this.screenWidth,this.newImgHeight)}},MilleniumFalcon.prototype={atualizar:function(){if(this.chewbaccaAtirar(),!this.teclado.hasPressed())return this.x=this.touch.posicaoX()-this.imagem.width/2,void(this.y=this.touch.posicaoY()-(this.imagem.height/2+50));var i=this.velocidade*this.animacao.decorrido/1e3;this.teclado.pressionada(SETA_ESQUERDA)&&this.x>0&&(this.x-=i),this.teclado.pressionada(SETA_DIREITA)&&this.x<this.context.canvas.width-this.imagem.width&&(this.x+=i),this.teclado.pressionada(SETA_ACIMA)&&this.y>0&&(this.y-=i),this.teclado.pressionada(SETA_ABAIXO)&&this.y<this.context.canvas.height-this.imagem.height&&(this.y+=i)},chewbaccaAtirar:function(){var i=(new Date).getTime(),t=i-this.ultimoTiro;t<290||(this.atirar(),this.ultimoTiro=i)},desenhar:function(){this.context.drawImage(this.imagem,this.x,this.y,this.imagem.width,this.imagem.height)},atirar:function(){var i=new Tiro(this.context,this);this.animacao.novoSprite(i),this.colisor.novoSprite(i)},retangulosColisao:function(){return[{x:this.x+13,y:this.y+22,largura:60,altura:80}]},colidiuCom:function(i){if(i instanceof TieFighter||i instanceof Asteroid){this.animacao.excluirSprite(this),this.animacao.excluirSprite(i),this.colisor.excluirSprite(this),this.colisor.excluirSprite(i),window.navigator.vibrate(300);var t=new Explosao(this.context,this.imagemExplosao,this.x,this.y),a=new Explosao(this.context,this.imagemExplosao,i.x,i.y);this.animacao.novoSprite(t),this.animacao.novoSprite(a);var o=this;t.fimDaExplosao=function(){o.vidasExtras--,o.vidasExtras<0?o.acabaramVidas&&o.acabaramVidas():(o.colisor.novoSprite(o),o.animacao.novoSprite(o),o.posicionar())}}},posicionar:function(){var i=this.context.canvas;this.x=i.width/2-40.83333,this.y=i.height-110}},TieFighter.prototype={atualizar:function(){this.y+=this.velocidade*this.animacao.decorrido/500,this.x+=this.direction,(this.y>this.canvasHeight||this.x>this.canvasWidth)&&(this.animacao.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context,t=this.imagem;i.drawImage(t,this.x,this.y,t.width,t.height)},retangulosColisao:function(){return[{x:this.x,y:this.y+10,largura:45,altura:22}]},colidiuCom:function(i){if(i instanceof Tiro){this.animacao.excluirSprite(this),this.colisor.excluirSprite(this),this.animacao.excluirSprite(i),this.colisor.excluirSprite(i);var t=new Explosao(this.context,this.imgExplosao,this.x,this.y);this.animacao.novoSprite(t)}}},Asteroid.prototype={atualizar:function(){this.y+=this.velocidade*this.animacao.decorrido/500,this.y>this.canvasHeight&&(this.animacao.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context,t=this.imagem;i.drawImage(t,this.x,this.y,t.width,t.height)},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:45,altura:45}]},colidiuCom:function(i){if(i instanceof Tiro){this.animacao.excluirSprite(this),this.colisor.excluirSprite(this),this.animacao.excluirSprite(i),this.colisor.excluirSprite(i);var t=new Explosao(this.context,this.imgExplosao,this.x,this.y);this.animacao.novoSprite(t)}}};var SOM_TIRO=new Audio;SOM_TIRO.src="snd/laser.wav",SOM_TIRO.volume=.1,SOM_TIRO.load(),Tiro.prototype={atualizar:function(){this.y-=this.velocidade*this.animacao.decorrido/500,this.y<0&&(this.animacao.excluirSprite(this),this.colisor.excluirSprite(this))},desenhar:function(){var i=this.context;i.save(),i.fillStyle=this.cor,i.fillRect(this.x,this.y,this.largura,this.altura),i.restore()},retangulosColisao:function(){return[{x:this.x,y:this.y,largura:6,altura:16}]},colidiuCom:function(i){}};var SOM_EXPLOSAO=new Audio;SOM_EXPLOSAO.src="snd/explosion.wav",SOM_EXPLOSAO.volume=.4,SOM_EXPLOSAO.load(),Explosao.prototype={atualizar:function(){},desenhar:function(){this.spritesheet.desenhar(this.x,this.y),this.spritesheet.proximoQuadro()}},Painel.prototype={atualizar:function(){},desenhar:function(){var i=this.context;i.save(),i.fillStyle="yellow",i.font="15px Lcd-Solid",i.fillText("Current "+this.pontuacao,i.canvas.width-120,30),i.fillStyle="red",i.fillText("HI "+this.pontuacaoMaxima,i.canvas.width-190,30),i.restore();for(var t=9,a=10,o=1;o<=this.nave.vidasExtras;o++)this.context.drawImage(this.imagemVida,t,a),t+=37}},"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js",{scope:""}).then(function(i){console.log("Registration succeeded. Scope is "+i.scope)})["catch"](function(i){console.log("Registration failed with "+i)}),window.addEventListener("beforeinstallprompt",function(i){outputElement.textContent="beforeinstallprompt Event fired"});var canvas=document.getElementById("canvas_animacao");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var context=canvas.getContext("2d");context.font="16px Lcd-Solid";var imagens,animacao,teclado,colisor,milleniumFalcon,criadorInimigos,painel,touch,totalImagens=0,carregadas=0,musicaAcao;carregarImagens(),carregarMusicas();var isGameOver=!1;